<!DOCTYPE html>
<html lang="en">

<head>
    <script src="/js/script.js" defer></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4T90FQG02K"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-4T90FQG02K');
    </script>
    <!-- AdSense account verification -->
    <meta name="google-adsense-account" content="ca-pub-7933209486512555">

    <!-- AdSense Auto Ads -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7933209486512555"
        crossorigin="anonymous"></script>
    <meta charset="utf-8" />
    <title>Disk Usage Visualizer ‚Äî RDroid Apps</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="canonical" href="https://rdroidapps.com/windows-tools/system/disk-usage-visualizer.html" />
    <link rel="stylesheet" href="/css/style.css">
    <meta name="description"
        content="Visualize disk usage with interactive charts and treemap. Analyze storage distribution by file types and folders. All processing done locally." />
    <meta name="keywords"
        content="disk usage visualizer, storage analyzer, disk space analyzer, treemap visualization, storage chart" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <style>
        .card {
            width: auto;
        }
    </style>
</head>

<body>
    <!-- HEADER -->
    <div id="header-container"></div>

    <!-- TOOLS QUICK LINKS -->
    <div id="tools-links-container"></div>

    <!-- MENU DRAWER -->
    <div id="menu-drawer-container"></div>

    <!-- Load components -->
    <script>
        $(function () {
            $("#header-container").load("/components/header.html");
            $("#menu-drawer-container").load("/components/menu-drawer.html");
            $("#tools-links-container").load("/components/system-tools-quick-links.html");
            $("#footer-container").load("/components/footer.html");
        });
    </script>

    <section class="section" role="main" aria-labelledby="title">
        <h1 id="title">Disk Usage Visualizer</h1>
        <p class="lead">Visualize disk usage with interactive charts and treemap visualization. Analyze storage
            distribution
            by file types, folders, and sizes. All processing is done locally in your browser.</p>

        <div class="card" style="margin-top: 24px;">
            <div class="drop" id="dropArea">
                <p>üíæ Drop folders or files here to analyze</p>
                <p class="small">or</p>
                <button class="btn" id="chooseBtn">Choose Folders/Files</button>
                <input type="file" id="fileInput" webkitdirectory multiple style="display:none" />
                <p class="small" style="margin-top: 12px;">Supports folder selection in Chrome/Edge. For other browsers,
                    select
                    multiple files.</p>
            </div>

            <div class="controls" style="margin-top: 20px;">
                <div class="control">
                    <label>Visualization Type</label>
                    <select id="vizType">
                        <option value="treemap">Treemap</option>
                        <option value="pie">Pie Chart</option>
                        <option value="bar">Bar Chart</option>
                        <option value="sunburst">Sunburst</option>
                    </select>
                </div>
                <div class="control">
                    <label>Group By</label>
                    <select id="groupBy">
                        <option value="type">File Type</option>
                        <option value="folder">Folder</option>
                        <option value="size">Size Range</option>
                        <option value="date">Date Modified</option>
                    </select>
                </div>
                <div class="control">
                    <label>Color Scheme</label>
                    <select id="colorScheme">
                        <option value="rainbow">Rainbow</option>
                        <option value="blues">Blues</option>
                        <option value="greens">Greens</option>
                        <option value="category">Category</option>
                    </select>
                </div>
            </div>

            <div style="display:flex; gap:12px; align-items:center; margin-top: 20px;">
                <button class="btn btn-primary" id="analyzeBtn" disabled>üìä Analyze & Visualize</button>
                <button class="btn" id="clearBtn">Clear</button>
                <button class="btn" id="sampleBtn">Load Sample Data</button>
                <div style="margin-left:auto" id="summaryInfo" class="small"></div>
            </div>

            <div class="progress" id="progressWrap" style="display: none; margin-top: 15px;">
                <div class="bar" id="progressBar"></div>
            </div>

            <div class="tabs" style="margin-top: 20px;">
                <button class="tab-btn active" data-tab="visualization">Visualization</button>
                <button class="tab-btn" data-tab="details">Details</button>
                <button class="tab-btn" data-tab="statistics">Statistics</button>
                <button class="tab-btn" data-tab="insights">Insights</button>
            </div>

            <!-- Visualization Tab -->
            <div class="tab-content active" id="visualization">
                <div style="display: flex; gap: 20px; margin-top: 15px; flex-wrap: wrap;">
                    <div style="flex: 2; min-width: 300px;">
                        <div id="chartContainer"
                            style="width: 100%; height: 400px; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 10px;">
                            <div id="vizArea"
                                style="width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; color: var(--muted);">
                                <p>Select files/folders and click "Analyze & Visualize" to see disk usage visualization
                                </p>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 10px; justify-content: center;">
                            <button class="btn" id="exportVizBtn" disabled>üì• Export as PNG</button>
                            <button class="btn" id="fullscreenBtn" disabled>üñ•Ô∏è Fullscreen</button>
                        </div>
                    </div>
                    <div style="flex: 1; min-width: 250px;">
                        <div class="card" style="background: rgba(255,255,255,0.02);">
                            <h3>Legend</h3>
                            <div id="legendContainer" style="margin-top: 10px;">
                                <div class="small" style="text-align: center; color: var(--muted);">No data to display
                                </div>
                            </div>
                        </div>
                        <div class="card" style="background: rgba(255,255,255,0.02); margin-top: 10px;">
                            <h3>Filters</h3>
                            <div style="margin-top: 10px;">
                                <div class="optionRow">
                                    <input type="checkbox" id="filterLarge" checked>
                                    <label for="filterLarge" class="small">Show files > 1MB</label>
                                </div>
                                <div class="optionRow">
                                    <input type="checkbox" id="filterEmpty" checked>
                                    <label for="filterEmpty" class="small">Hide empty folders</label>
                                </div>
                                <div class="optionRow">
                                    <input type="range" id="sizeThreshold" min="0" max="100" value="0"
                                        style="width: 100%;">
                                    <label for="sizeThreshold" class="small">Size threshold: <span
                                            id="thresholdValue">0%</span></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Details Tab -->
            <div class="tab-content" id="details">
                <div style="margin-top: 15px;">
                    <div class="advanced-controls">
                        <input type="text" id="searchFiles" placeholder="Search files/folders..." style="flex: 1;">
                        <button class="btn" id="expandAllBtn">Expand All</button>
                        <button class="btn" id="collapseAllBtn">Collapse All</button>
                    </div>
                    <div id="detailsContainer" class="preview"
                        style="margin-top: 10px; max-height: 400px; overflow: auto;">
                        <div style="text-align: center; padding: 40px 20px; color: var(--muted);">
                            <p>No data to display</p>
                            <p class="small">Select files/folders to see detailed breakdown</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics Tab -->
            <div class="tab-content" id="statistics">
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div class="card" style="text-align: center;">
                        <h3>üìÅ Total Folders</h3>
                        <div style="font-size: 28px; font-weight: bold; color: var(--brand);" id="statFolders">0</div>
                    </div>
                    <div class="card" style="text-align: center;">
                        <h3>üìÑ Total Files</h3>
                        <div style="font-size: 28px; font-weight: bold; color: var(--brand2);" id="statFiles">0</div>
                    </div>
                    <div class="card" style="text-align: center;">
                        <h3>üíæ Total Size</h3>
                        <div style="font-size: 28px; font-weight: bold; color: var(--accent);" id="statSize">0 B</div>
                    </div>
                    <div class="card" style="text-align: center;">
                        <h3>üìä Avg File Size</h3>
                        <div style="font-size: 28px; font-weight: bold; color: var(--primary);" id="statAvgSize">0 B
                        </div>
                    </div>
                </div>
                <div class="card" style="margin-top: 15px;">
                    <h3>File Type Distribution</h3>
                    <table class="table-preview" id="typeDistribution">
                        <tr>
                            <th>File Type</th>
                            <th>Count</th>
                            <th>Total Size</th>
                            <th>Percentage</th>
                        </tr>
                        <tr>
                            <td colspan="4" style="text-align: center; color: var(--muted);">No data available</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Insights Tab -->
            <div class="tab-content" id="insights">
                <div class="card" style="margin-top: 15px;">
                    <h3>üí° Storage Insights</h3>
                    <div id="insightsContainer">
                        <div class="preview" style="text-align: center; padding: 20px; color: var(--muted);">
                            <p>Analyze your files to get personalized storage insights</p>
                        </div>
                    </div>
                </div>
                <div class="card" style="margin-top: 15px;">
                    <h3>üéØ Recommendations</h3>
                    <div id="recommendationsContainer">
                        <div class="preview" style="text-align: center; padding: 20px; color: var(--muted);">
                            <p>Get personalized recommendations based on your disk usage patterns</p>
                        </div>
                    </div>
                </div>
            </div>

            <div style="display:flex; gap:12px; margin-top: 20px;">
                <button class="btn" id="exportReportBtn" disabled>üìÑ Export Report</button>
                <button class="btn" id="shareBtn" disabled>üîó Share Visualization</button>
                <button class="btn" id="compareBtn">üîÑ Compare Snapshots</button>
            </div>
        </div>

        <hr style="margin: 32px 0;">
        <section class="seo-content">
            <h2>About Disk Usage Visualizer</h2>
            <p>
                Disk Usage Visualizer provides interactive visualization of your disk storage. It helps you understand
                how
                storage space is being utilized through treemaps, pie charts, and other visual representations. All
                processing
                happens locally in your browser for maximum privacy and security.
            </p>

            <h2>Key Features</h2>
            <ul class="about-points">
                <li><strong>Multiple Visualization Types:</strong> Treemap, pie chart, bar chart, and sunburst diagram
                </li>
                <li><strong>Interactive Exploration:</strong> Click to drill down into folders and explore file
                    hierarchy</li>
                <li><strong>File Type Analysis:</strong> Color-coded visualization by file extensions and types</li>
                <li><strong>Size-Based Filtering:</strong> Filter files by size thresholds to focus on large files</li>
                <li><strong>Detailed Statistics:</strong> Comprehensive statistics on file counts, sizes, and
                    distributions</li>
                <li><strong>Storage Insights:</strong> AI-powered insights and recommendations for optimizing storage
                </li>
                <li><strong>Export Options:</strong> Export visualizations as PNG images and reports as JSON/CSV</li>
                <li><strong>No Data Upload:</strong> All processing happens locally in your browser</li>
            </ul>

            <h2>How It Works</h2>
            <ol class="about-points">
                <li><strong>Select Data:</strong> Choose folders or files using the file picker or drag-and-drop
                    interface</li>
                <li><strong>Configure Visualization:</strong> Select visualization type, grouping method, and color
                    scheme</li>
                <li><strong>Analyze:</strong> Click "Analyze & Visualize" to process and display disk usage</li>
                <li><strong>Explore:</strong> Interact with the visualization to explore different levels of detail</li>
                <li><strong>Take Action:</strong> Use insights and recommendations to optimize your storage usage</li>
            </ol>

            <h2>Visualization Types Explained</h2>
            <ul class="about-points">
                <li><strong>Treemap:</strong> Hierarchical rectangles where size represents file/folder size - best for
                    overview</li>
                <li><strong>Pie Chart:</strong> Circular chart showing proportions - best for high-level category
                    breakdown</li>
                <li><strong>Bar Chart:</strong> Vertical/horizontal bars comparing sizes - best for comparing specific
                    items</li>
                <li><strong>Sunburst:</strong> Multi-level radial chart - best for hierarchical depth exploration</li>
            </ul>

            <h2>Privacy & Security</h2>
            <p>
                Your files never leave your computer. All analysis and visualization happen entirely within your web
                browser.
                No data is sent to external servers, ensuring complete privacy and security for your files and folder
                structures.
            </p>

            <h2>Use Cases</h2>
            <ul class="about-points">
                <li><strong>Storage Cleanup:</strong> Identify large files and folders taking up unnecessary space</li>
                <li><strong>Project Analysis:</strong> Analyze project folder structures and file distributions</li>
                <li><strong>Backup Planning:</strong> Understand what needs to be backed up based on size and importance
                </li>
                <li><strong>System Maintenance:</strong> Monitor disk usage patterns over time</li>
                <li><strong>Educational:</strong> Learn about file systems and storage management visually</li>
            </ul>
            <section class="related-tools">
                <h2>Related System Tools</h2>
                <ul>
                    <a href="/windows-tools/system/file-renamer.html" class="btn tools">File Renamer Tool</a>
                    <a href="/windows-tools/system/folder-size-analyzer.html" class="btn tools">Folder Size
                        Analyzer</a>
                    <a href="/windows-tools/system/system-info-checker.html" class="btn tools">System Information
                        Tool</a>
                </ul>
            </section>
        </section><br>
        <a href="/windows-tools/system/index.html" class="nav-button home">üè† Back to Systen Home</a>
    </section>

    <!-- FOOTER -->
    <div id="footer-container"></div>

    <script>
        function toggleMenu() {
            document.getElementById("drawer").classList.toggle("open");
        }
        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.getAttribute('data-tab');
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Elements
        const fileInput = document.getElementById('fileInput');
        const chooseBtn = document.getElementById('chooseBtn');
        const dropArea = document.getElementById('dropArea');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const clearBtn = document.getElementById('clearBtn');
        const sampleBtn = document.getElementById('sampleBtn');
        const progressWrap = document.getElementById('progressWrap');
        const progressBar = document.getElementById('progressBar');
        const summaryInfo = document.getElementById('summaryInfo');
        const vizArea = document.getElementById('vizArea');
        const legendContainer = document.getElementById('legendContainer');
        const detailsContainer = document.getElementById('detailsContainer');
        const insightsContainer = document.getElementById('insightsContainer');
        const recommendationsContainer = document.getElementById('recommendationsContainer');
        const exportVizBtn = document.getElementById('exportVizBtn');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const exportReportBtn = document.getElementById('exportReportBtn');
        const shareBtn = document.getElementById('shareBtn');
        const compareBtn = document.getElementById('compareBtn');

        let filesData = [];
        let analysisData = null;
        let chartInstance = null;
        let d3Instance = null;

        // File selection
        chooseBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelection);

        // Drag and drop
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.classList.add('dragover');
        });
        dropArea.addEventListener('dragleave', () => dropArea.classList.remove('dragover'));
        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.classList.remove('dragover');
            if (e.dataTransfer.items) {
                handleFileDrop(e.dataTransfer.items);
            } else {
                processFileList(e.dataTransfer.files);
            }
        });

        // Handle file selection
        function handleFileSelection(e) {
            const fileList = e.target.files;
            processFileList(fileList);
        }

        // Handle file drop with directory support
        function handleFileDrop(items) {
            filesData = [];
            const processEntry = (entry, path = '') => {
                return new Promise((resolve) => {
                    if (entry.isFile) {
                        entry.file(file => {
                            filesData.push(createFileData(file, path + entry.name));
                            resolve();
                        });
                    } else if (entry.isDirectory) {
                        const reader = entry.createReader();
                        reader.readEntries(entries => {
                            const promises = entries.map(childEntry =>
                                processEntry(childEntry, path + entry.name + '/')
                            );
                            Promise.all(promises).then(resolve);
                        });
                    }
                });
            };

            const promises = [];
            for (let i = 0; i < items.length; i++) {
                const entry = items[i].webkitGetAsEntry();
                if (entry) {
                    promises.push(processEntry(entry));
                }
            }

            Promise.all(promises).then(() => {
                updateSummary();
                analyzeBtn.disabled = false;
            });
        }

        // Process file list
        function processFileList(fileList) {
            filesData = [];
            for (let i = 0; i < fileList.length; i++) {
                const file = fileList[i];
                filesData.push(createFileData(file, file.webkitRelativePath || file.name));
            }
            updateSummary();
            analyzeBtn.disabled = false;
        }

        // Create file data object
        function createFileData(file, path) {
            const name = file.name;
            const ext = name.split('.').pop().toLowerCase();
            const type = getFileType(ext);

            return {
                file: file,
                path: path,
                name: name,
                size: file.size,
                type: type,
                extension: ext,
                lastModified: file.lastModified,
                category: getFileCategory(type, ext)
            };
        }

        // Get file type category
        function getFileType(ext) {
            const imageExts = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'];
            const documentExts = ['pdf', 'doc', 'docx', 'txt', 'rtf', 'odt'];
            const videoExts = ['mp4', 'avi', 'mkv', 'mov', 'wmv', 'flv'];
            const audioExts = ['mp3', 'wav', 'ogg', 'flac', 'm4a'];
            const archiveExts = ['zip', 'rar', '7z', 'tar', 'gz'];
            const codeExts = ['html', 'css', 'js', 'py', 'java', 'cpp', 'json'];

            if (imageExts.includes(ext)) return 'image';
            if (documentExts.includes(ext)) return 'document';
            if (videoExts.includes(ext)) return 'video';
            if (audioExts.includes(ext)) return 'audio';
            if (archiveExts.includes(ext)) return 'archive';
            if (codeExts.includes(ext)) return 'code';
            return 'other';
        }

        // Get file category for coloring
        function getFileCategory(type, ext) {
            const categories = {
                'image': 'Images',
                'document': 'Documents',
                'video': 'Videos',
                'audio': 'Audio',
                'archive': 'Archives',
                'code': 'Code',
                'other': 'Other'
            };
            return categories[type] || 'Other';
        }

        // Update summary info
        function updateSummary() {
            const totalSize = filesData.reduce((sum, item) => sum + item.size, 0);
            const fileCount = filesData.length;

            summaryInfo.textContent = `${fileCount} files ‚Ä¢ ${formatSize(totalSize)}`;
        }

        // Format size function
        function formatSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Load sample data
        sampleBtn.addEventListener('click', () => {
            filesData = generateSampleData();
            updateSummary();
            analyzeBtn.disabled = false;
            analyzeBtn.click();
        });

        // Generate sample data
        function generateSampleData() {
            const sampleFiles = [
                { name: 'Documents', type: 'folder', size: 250000000, count: 45 },
                { name: 'Pictures', type: 'folder', size: 1800000000, count: 120 },
                { name: 'Videos', type: 'folder', size: 3500000000, count: 15 },
                { name: 'Music', type: 'folder', size: 800000000, count: 85 },
                { name: 'Downloads', type: 'folder', size: 1200000000, count: 210 },
                { name: 'Applications', type: 'folder', size: 5000000000, count: 25 },
                { name: 'System', type: 'folder', size: 15000000000, count: 1200 }
            ];

            const files = [];
            sampleFiles.forEach(folder => {
                // Add the folder itself
                files.push({
                    file: { name: folder.name },
                    path: folder.name + '/',
                    name: folder.name,
                    size: folder.size,
                    type: 'folder',
                    extension: '',
                    lastModified: Date.now(),
                    category: 'Folder'
                });

                // Add some sample files within the folder
                const fileTypes = ['jpg', 'pdf', 'mp4', 'mp3', 'zip', 'exe', 'docx'];
                for (let i = 1; i <= 5; i++) {
                    const ext = fileTypes[Math.floor(Math.random() * fileTypes.length)];
                    const size = Math.floor(Math.random() * (folder.size / 10));
                    files.push({
                        file: { name: `file${i}.${ext}` },
                        path: folder.name + `/file${i}.${ext}`,
                        name: `file${i}.${ext}`,
                        size: size,
                        type: getFileType(ext),
                        extension: ext,
                        lastModified: Date.now() - Math.random() * 31536000000, // Random date within last year
                        category: getFileCategory(getFileType(ext), ext)
                    });
                }
            });

            return files;
        }

        // Analyze and visualize
        analyzeBtn.addEventListener('click', () => {
            if (filesData.length === 0) {
                alert('Please select files/folders first or use sample data.');
                return;
            }

            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'Processing...';
            progressWrap.style.display = 'block';
            progressBar.style.width = '0%';

            // Simulate processing
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 5;
                progressBar.style.width = progress + '%';
                progressBar.textContent = progress + '%';
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    performAnalysis();
                }
            }, 50);
        });

        // Perform analysis
        function performAnalysis() {
            // Group data for analysis
            const groupedByCategory = {};
            const groupedByType = {};
            let totalSize = 0;
            let folderCount = 0;
            let fileCount = 0;

            filesData.forEach(item => {
                totalSize += item.size;
                if (item.type === 'folder') {
                    folderCount++;
                } else {
                    fileCount++;
                }

                // Group by category
                if (!groupedByCategory[item.category]) {
                    groupedByCategory[item.category] = { size: 0, count: 0 };
                }
                groupedByCategory[item.category].size += item.size;
                groupedByCategory[item.category].count++;

                // Group by file type
                if (item.type !== 'folder') {
                    if (!groupedByType[item.extension]) {
                        groupedByType[item.extension] = { size: 0, count: 0, name: item.extension };
                    }
                    groupedByType[item.extension].size += item.size;
                    groupedByType[item.extension].count++;
                }
            });

            // Prepare analysis data
            analysisData = {
                totalSize: totalSize,
                folderCount: folderCount,
                fileCount: fileCount,
                averageFileSize: fileCount > 0 ? totalSize / fileCount : 0,
                groupedByCategory: groupedByCategory,
                groupedByType: groupedByType,
                files: filesData,
                timestamp: new Date().toISOString()
            };

            // Update UI
            updateVisualization();
            updateDetails();
            updateStatistics();
            updateInsights();

            analyzeBtn.disabled = false;
            analyzeBtn.textContent = 'üìä Analyze & Visualize';
            progressWrap.style.display = 'none';
            exportVizBtn.disabled = false;
            exportReportBtn.disabled = false;
            shareBtn.disabled = false;
            fullscreenBtn.disabled = false;
        }

        // Update visualization
        function updateVisualization() {
            const vizType = document.getElementById('vizType').value;
            const groupBy = document.getElementById('groupBy').value;
            const colorScheme = document.getElementById('colorScheme').value;

            vizArea.innerHTML = '';

            if (vizType === 'treemap') {
                createTreemap();
            } else if (vizType === 'pie') {
                createPieChart();
            } else if (vizType === 'bar') {
                createBarChart();
            } else if (vizType === 'sunburst') {
                createSunburst();
            }

            updateLegend();
        }

        // Create treemap visualization
        function createTreemap() {
            const width = vizArea.clientWidth;
            const height = vizArea.clientHeight;

            // Prepare data for treemap
            const data = {
                name: "root",
                children: []
            };

            // Group data based on selection
            const groupBy = document.getElementById('groupBy').value;
            let groupedData = {};

            if (groupBy === 'category') {
                groupedData = analysisData.groupedByCategory;
                Object.entries(groupedData).forEach(([category, info]) => {
                    data.children.push({
                        name: category,
                        value: info.size,
                        count: info.count
                    });
                });
            } else if (groupBy === 'type') {
                groupedData = analysisData.groupedByType;
                Object.entries(groupedData).forEach(([type, info]) => {
                    data.children.push({
                        name: `.${type}`,
                        value: info.size,
                        count: info.count
                    });
                });
            }

            // Create treemap using D3
            const svg = d3.select(vizArea)
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            const treemap = d3.treemap()
                .size([width, height])
                .padding(1);

            const root = d3.hierarchy(data)
                .sum(d => d.value)
                .sort((a, b) => b.value - a.value);

            treemap(root);

            const color = d3.scaleOrdinal(d3.schemeCategory10);

            const cell = svg.selectAll("g")
                .data(root.leaves())
                .enter().append("g")
                .attr("transform", d => `translate(${d.x0},${d.y0})`);

            cell.append("rect")
                .attr("width", d => d.x1 - d.x0)
                .attr("height", d => d.y1 - d.y0)
                .attr("fill", d => color(d.data.name))
                .attr("stroke", "#fff");

            cell.append("text")
                .attr("x", 5)
                .attr("y", 15)
                .text(d => d.data.name)
                .attr("font-size", "12px")
                .attr("fill", "#fff");

            cell.append("text")
                .attr("x", 5)
                .attr("y", 30)
                .text(d => formatSize(d.data.value))
                .attr("font-size", "10px")
                .attr("fill", "#ccc");

            d3Instance = svg;
        }

        // Create pie chart
        function createPieChart() {
            const ctx = document.createElement('canvas');
            ctx.width = vizArea.clientWidth;
            ctx.height = vizArea.clientHeight;
            vizArea.appendChild(ctx);

            const groupBy = document.getElementById('groupBy').value;
            let labels = [];
            let data = [];
            let colors = [];

            if (groupBy === 'category') {
                const categories = analysisData.groupedByCategory;
                Object.entries(categories).forEach(([category, info], index) => {
                    labels.push(category);
                    data.push(info.size);
                    colors.push(getColor(index, Object.keys(categories).length));
                });
            }

            chartInstance = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderColor: 'rgba(255, 255, 255, 0.1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const value = context.raw;
                                    const percentage = ((value / analysisData.totalSize) * 100).toFixed(1);
                                    return `${context.label}: ${formatSize(value)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Create bar chart
        function createBarChart() {
            const ctx = document.createElement('canvas');
            ctx.width = vizArea.clientWidth;
            ctx.height = vizArea.clientHeight;
            vizArea.appendChild(ctx);

            const groupBy = document.getElementById('groupBy').value;
            let labels = [];
            let data = [];
            let colors = [];

            if (groupBy === 'category') {
                const categories = analysisData.groupedByCategory;
                Object.entries(categories).forEach(([category, info], index) => {
                    labels.push(category);
                    data.push(info.size);
                    colors.push(getColor(index, Object.keys(categories).length));
                });
            }

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Size',
                        data: data,
                        backgroundColor: colors,
                        borderColor: 'rgba(255, 255, 255, 0.1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function (value) {
                                    return formatSize(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return formatSize(context.raw);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Create sunburst visualization (simplified)
        function createSunburst() {
            vizArea.innerHTML = `
        <div style="text-align: center; padding: 50px 20px;">
          <div style="font-size: 48px;">‚òÄÔ∏è</div>
          <h3>Sunburst Visualization</h3>
          <p class="small">This visualization type is best for hierarchical data exploration</p>
          <p class="small">Total size: ${formatSize(analysisData.totalSize)}</p>
          <p class="small">Files: ${analysisData.fileCount}, Folders: ${analysisData.folderCount}</p>
        </div>
      `;
        }

        // Get color based on index and total
        function getColor(index, total) {
            const schemes = {
                rainbow: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'],
                blues: ['#0ea5e9', '#38bdf8', '#22d3ee', '#6ec9ff', '#b1e5ff'],
                greens: ['#22d3a6', '#34d399', '#10b981', '#6ee7b7', '#a7f3d0'],
                category: ['#22d3a6', '#0ea5e9', '#8b5cf6', '#ef4444', '#f59e0b', '#10b981', '#6366f1']
            };

            const scheme = document.getElementById('colorScheme').value;
            const colors = schemes[scheme] || schemes.rainbow;
            return colors[index % colors.length];
        }

        // Update legend
        function updateLegend() {
            if (!analysisData) return;

            const groupBy = document.getElementById('groupBy').value;
            let items = [];

            if (groupBy === 'category') {
                items = Object.entries(analysisData.groupedByCategory).map(([category, info], index) => ({
                    name: category,
                    size: info.size,
                    count: info.count,
                    color: getColor(index, Object.keys(analysisData.groupedByCategory).length)
                }));
            }

            let html = '';
            items.forEach(item => {
                const percentage = ((item.size / analysisData.totalSize) * 100).toFixed(1);
                html += `
          <div style="display: flex; align-items: center; margin-bottom: 8px; padding: 4px; border-radius: 4px; background: rgba(255,255,255,0.05);">
            <div style="width: 12px; height: 12px; background: ${item.color}; margin-right: 8px; border-radius: 2px;"></div>
            <div style="flex: 1;">
              <div style="font-size: 12px; font-weight: bold;">${item.name}</div>
              <div style="font-size: 10px; color: var(--muted);">${formatSize(item.size)} (${percentage}%)</div>
            </div>
            <div style="font-size: 10px; color: var(--muted);">${item.count}</div>
          </div>
        `;
            });

            legendContainer.innerHTML = html || '<div class="small" style="text-align: center; color: var(--muted);">No data</div>';
        }

        // Update details view
        function updateDetails() {
            if (!analysisData) return;

            let html = '<div class="files-list">';

            // Sort files by size (largest first)
            const sortedFiles = [...analysisData.files].sort((a, b) => b.size - a.size);

            sortedFiles.slice(0, 50).forEach((item, index) => {
                const isFolder = item.type === 'folder';
                const icon = isFolder ? 'üìÅ' : getFileIcon(item.extension);
                const percentage = ((item.size / analysisData.totalSize) * 100).toFixed(2);

                html += `
          <div class="file-item">
            <div style="display: flex; align-items: center; gap: 8px;">
              <span>${icon}</span>
              <div style="flex: 1; min-width: 0;">
                <div style="font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${item.name}</div>
                <div class="small" style="color: var(--muted);">${item.path}</div>
              </div>
            </div>
            <div class="file-meta">${formatSize(item.size)}</div>
            <div class="file-actions">
              <span class="small">${percentage}%</span>
              <span class="small" style="margin-left: 8px;">${item.category}</span>
            </div>
          </div>
        `;
            });

            html += '</div>';
            detailsContainer.innerHTML = html;
        }

        // Get file icon
        function getFileIcon(ext) {
            const icons = {
                'jpg': 'üñºÔ∏è', 'jpeg': 'üñºÔ∏è', 'png': 'üñºÔ∏è', 'gif': 'üñºÔ∏è',
                'pdf': 'üìÑ', 'doc': 'üìÑ', 'docx': 'üìÑ', 'txt': 'üìÑ',
                'mp4': 'üé¨', 'avi': 'üé¨', 'mkv': 'üé¨',
                'mp3': 'üéµ', 'wav': 'üéµ',
                'zip': 'üì¶', 'rar': 'üì¶',
                'html': 'üåê', 'css': 'üé®', 'js': '‚ö°',
                'exe': '‚öôÔ∏è', 'msi': '‚öôÔ∏è',
                'folder': 'üìÅ'
            };
            return icons[ext] || 'üìÑ';
        }

        // Update statistics
        function updateStatistics() {
            if (!analysisData) return;

            document.getElementById('statFolders').textContent = analysisData.folderCount;
            document.getElementById('statFiles').textContent = analysisData.fileCount;
            document.getElementById('statSize').textContent = formatSize(analysisData.totalSize);
            document.getElementById('statAvgSize').textContent = formatSize(analysisData.averageFileSize);

            // Update type distribution table
            const typeTable = document.getElementById('typeDistribution');
            let html = '<tr><th>File Type</th><th>Count</th><th>Total Size</th><th>Percentage</th></tr>';

            const sortedTypes = Object.entries(analysisData.groupedByType)
                .sort((a, b) => b[1].size - a[1].size);

            sortedTypes.forEach(([type, info]) => {
                const percentage = ((info.size / analysisData.totalSize) * 100).toFixed(1);
                html += `
          <tr>
            <td>.${type}</td>
            <td>${info.count}</td>
            <td>${formatSize(info.size)}</td>
            <td>${percentage}%</td>
          </tr>
        `;
            });

            typeTable.innerHTML = html;
        }

        // Update insights
        function updateInsights() {
            if (!analysisData) return;

            // Generate insights based on data
            const largestCategory = Object.entries(analysisData.groupedByCategory)
                .sort((a, b) => b[1].size - a[1].size)[0];

            const avgFileSizeMB = analysisData.averageFileSize / (1024 * 1024);

            let insightsHTML = '<ul>';

            if (largestCategory) {
                const percentage = ((largestCategory[1].size / analysisData.totalSize) * 100).toFixed(1);
                insightsHTML += `<li><strong>${largestCategory[0]}</strong> takes up ${percentage}% of your total storage (${formatSize(largestCategory[1].size)})</li>`;
            }

            if (avgFileSizeMB > 10) {
                insightsHTML += `<li>Your average file size is ${avgFileSizeMB.toFixed(2)} MB, which is relatively large</li>`;
            } else if (avgFileSizeMB < 0.1) {
                insightsHTML += `<li>Your average file size is ${avgFileSizeMB.toFixed(2)} MB, which is relatively small</li>`;
            }

            if (analysisData.fileCount > 1000) {
                insightsHTML += `<li>You have ${analysisData.fileCount} files - consider archiving old files</li>`;
            }

            insightsHTML += '</ul>';
            insightsContainer.innerHTML = insightsHTML;

            // Generate recommendations
            let recommendationsHTML = '<ul>';

            if (largestCategory && largestCategory[0] === 'Videos' && largestCategory[1].size > 1000000000) {
                recommendationsHTML += '<li>Consider compressing or deleting large video files</li>';
            }

            if (analysisData.groupedByCategory['Archives'] && analysisData.groupedByCategory['Archives'].size > 500000000) {
                recommendationsHTML += '<li>Extract and delete old archive files you no longer need</li>';
            }

            if (analysisData.fileCount > 500) {
                recommendationsHTML += '<li>Use the file type filter to identify and remove duplicate files</li>';
            }

            recommendationsHTML += '<li>Regularly clean your downloads folder</li>';
            recommendationsHTML += '<li>Consider using cloud storage for files you access infrequently</li>';
            recommendationsHTML += '</ul>';

            recommendationsContainer.innerHTML = recommendationsHTML;
        }

        // Clear button
        clearBtn.addEventListener('click', () => {
            filesData = [];
            analysisData = null;
            fileInput.value = '';

            vizArea.innerHTML = '<p>Select files/folders and click "Analyze & Visualize" to see disk usage visualization</p>';
            legendContainer.innerHTML = '<div class="small" style="text-align: center; color: var(--muted);">No data to display</div>';
            detailsContainer.innerHTML = '<div style="text-align: center; padding: 40px 20px; color: var(--muted);"><p>No data to display</p><p class="small">Select files/folders to see detailed breakdown</p></div>';
            insightsContainer.innerHTML = '<div class="preview" style="text-align: center; padding: 20px; color: var(--muted);"><p>Analyze your files to get personalized storage insights</p></div>';
            recommendationsContainer.innerHTML = '<div class="preview" style="text-align: center; padding: 20px; color: var(--muted);"><p>Get personalized recommendations based on your disk usage patterns</p></div>';

            summaryInfo.textContent = '';
            analyzeBtn.disabled = true;
            exportVizBtn.disabled = true;
            exportReportBtn.disabled = true;
            shareBtn.disabled = true;
            fullscreenBtn.disabled = true;

            if (chartInstance) {
                chartInstance.destroy();
                chartInstance = null;
            }

            if (d3Instance) {
                d3Instance.remove();
                d3Instance = null;
            }

            // Reset statistics
            document.getElementById('statFolders').textContent = '0';
            document.getElementById('statFiles').textContent = '0';
            document.getElementById('statSize').textContent = '0 B';
            document.getElementById('statAvgSize').textContent = '0 B';

            const typeTable = document.getElementById('typeDistribution');
            typeTable.innerHTML = '<tr><th>File Type</th><th>Count</th><th>Total Size</th><th>Percentage</th></tr><tr><td colspan="4" style="text-align: center; color: var(--muted);">No data available</td></tr>';
        });

        // Export visualization as PNG
        exportVizBtn.addEventListener('click', () => {
            if (!analysisData) return;

            const vizType = document.getElementById('vizType').value;
            alert(`Exporting ${vizType} visualization as PNG...\n(In a real implementation, this would generate and download a PNG image)`);
        });

        // Fullscreen mode
        fullscreenBtn.addEventListener('click', () => {
            const elem = document.getElementById('chartContainer');
            if (!document.fullscreenElement) {
                elem.requestFullscreen().catch(err => {
                    console.error(`Error attempting to enable fullscreen: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        });

        // Export report
        exportReportBtn.addEventListener('click', () => {
            if (!analysisData) return;

            const report = {
                analysis: analysisData,
                timestamp: new Date().toISOString(),
                settings: {
                    vizType: document.getElementById('vizType').value,
                    groupBy: document.getElementById('groupBy').value,
                    colorScheme: document.getElementById('colorScheme').value
                }
            };

            const dataStr = JSON.stringify(report, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            const exportFileDefaultName = `disk-usage-report-${new Date().toISOString().slice(0, 10)}.json`;

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        });

        // Share button
        shareBtn.addEventListener('click', () => {
            if (!analysisData) return;

            const summary = `Disk Usage Analysis:
Total: ${formatSize(analysisData.totalSize)}
Files: ${analysisData.fileCount}
Folders: ${analysisData.folderCount}
Largest Category: ${Object.entries(analysisData.groupedByCategory).sort((a, b) => b[1].size - a[1].size)[0][0]}
Generated: ${new Date().toLocaleDateString()}`;

            if (navigator.share) {
                navigator.share({
                    title: 'Disk Usage Analysis',
                    text: summary,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(summary).then(() => {
                    alert('Analysis summary copied to clipboard!');
                });
            }
        });

        // Compare snapshots
        compareBtn.addEventListener('click', () => {
            alert('Compare feature would allow you to compare current analysis with previous snapshots.\nThis feature requires snapshot storage implementation.');
        });

        // Event listeners for settings changes
        document.getElementById('vizType').addEventListener('change', () => {
            if (analysisData) updateVisualization();
        });

        document.getElementById('groupBy').addEventListener('change', () => {
            if (analysisData) {
                updateVisualization();
                updateLegend();
            }
        });

        document.getElementById('colorScheme').addEventListener('change', () => {
            if (analysisData) {
                updateVisualization();
                updateLegend();
            }
        });

        // Size threshold slider
        const sizeThreshold = document.getElementById('sizeThreshold');
        const thresholdValue = document.getElementById('thresholdValue');

        sizeThreshold.addEventListener('input', () => {
            thresholdValue.textContent = sizeThreshold.value + '%';
            if (analysisData) {
                // In a real implementation, this would filter the visualization
            }
        });

        // Initialize
        updateVisualization();
    </script>
</body>

</html>
