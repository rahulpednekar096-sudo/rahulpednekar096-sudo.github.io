<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>PDF ‚Üí Text ‚Äî RDroid Apps</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="../../css/style.css">

  <!-- pdf.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

  <!-- OCR -->
  <script src="https://unpkg.com/tesseract.js@v4.1.1/dist/tesseract.min.js"></script>


</head>

<body>

  <!-- RDroidApps Header -->
  <header>
    <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
    <div class="logo">
      <img src="../../assets/my_brand_icon.png" alt="RDroid" />
      <div>RDroid <span>Apps</span></div>
    </div>
    <div class="nav-links">
      <a href="../../index.html" class="active">Home</a>
      <a href="../../apps.html">Apps</a>
      <a href="../../about.html">About</a>
      <a href="../../contact.html">Contact</a>
      <a href="../../windows-tools.html">Windows Tools</a>
    </div>
    <a href="../../auth/login.html" class="login-btn">üîë Login</a>
  </header>

  <!-- ===== DRAWER (UNCHANGED) ===== -->
  <nav id="drawer">
    <a href="../../index.html">üè† Home</a>
    <a href="../../apps.html">üì± Apps</a>
    <a href="../../favorites.html">‚≠ê Favorites</a>
    <a href="../../profile.html">üë§ Profile</a>
    <a href="../../about.html">‚ÑπÔ∏è About</a>
    <a href="../../contact.html">‚úâÔ∏è Contact</a>
    <a href="../../privacy-policy.html">üîí Privacy Policy</a>
  </nav>
  <section class="section">
    <h1>PDF ‚Üí Text</h1>
    <p class="lead">Extract text from any PDF. Optional OCR for scanned PDFs.</p>

    <div class="drop" id="dropArea">
      Drop PDF here or <button class="btn" id="pickBtn">Choose file</button>
      <input type="file" id="fileInput" accept="application/pdf" style="display:none">
    </div>

    <label style="display:block;margin-top:10px">
      <input type="checkbox" id="enableOCR"> Enable OCR (for scanned pages)
    </label>

    <div style="margin-top:12px;display:flex;gap:10px">
      <button class="btn-primary" id="extractBtn">Extract Text</button>
      <button class="btn" id="clearBtn">Clear</button>
    </div>

    <div class="progress" id="progressWrap">
      <div class="bar" id="progressBar"></div>
    </div>

    <div id="thumbs" class="thumbs"></div>

    <pre id="log" class="log">Ready.</pre>

    <textarea id="output" placeholder="Extracted text will appear here..."></textarea>

    <div style="margin-top:10px;display:flex;gap:10px">
      <button class="btn-primary" id="downloadBtn">Download .txt</button>
      <button class="btn" id="copyBtn">Copy</button>
    </div>

  </section>
  <footer>¬© 2025 RDroid Apps ‚Äî PDF Tools</footer>

  <script>
    // Drawer toggle
    function toggleMenu() {
      document.getElementById("drawer").classList.toggle("open");
    }
    const pickBtn = document.getElementById("pickBtn");
    const fileInput = document.getElementById("fileInput");
    const dropArea = document.getElementById("dropArea");
    const extractBtn = document.getElementById("extractBtn");
    const thumbs = document.getElementById("thumbs");
    const logEl = document.getElementById("log");
    const output = document.getElementById("output");
    const progressWrap = document.getElementById("progressWrap");
    const progressBar = document.getElementById("progressBar");
    const enableOCR = document.getElementById("enableOCR");

    let pdf = null;

    function log(msg) { logEl.textContent += "\n" + msg; logEl.scrollTop = logEl.scrollHeight; }
    function setProgress(v) { progressWrap.style.display = v >= 0 ? "block" : "none"; progressBar.style.width = (v * 100) + "%"; }

    pickBtn.onclick = () => fileInput.click();
    fileInput.onchange = e => loadPDF(e.target.files[0]);

    dropArea.ondragover = e => { e.preventDefault(); dropArea.style.borderColor = "#0aa37f"; }
    dropArea.ondragleave = () => dropArea.style.borderColor = "#222";
    dropArea.ondrop = e => {
      e.preventDefault(); dropArea.style.borderColor = "#222";
      loadPDF(e.dataTransfer.files[0]);
    };

    async function loadPDF(file) {
      if (!file) return;
      logEl.textContent = "Loading PDF...";
      pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";
      pdf = await pdfjsLib.getDocument({ data: await file.arrayBuffer() }).promise;
      log("PDF loaded, pages: " + pdf.numPages);
      await loadThumbnails();
    }

    async function loadThumbnails() {
      thumbs.innerHTML = "";
      for (let i = 1; i <= pdf.numPages; i++) {
        const p = await pdf.getPage(i);
        const vp = p.getViewport({ scale: .2 });
        const c = document.createElement("canvas");
        c.width = vp.width; c.height = vp.height;
        await p.render({ canvasContext: c.getContext("2d"), viewport: vp }).promise;
        const img = c.toDataURL();
        thumbs.innerHTML += `<div class="thumb">
      <img src="${img}">
      <label><input type="checkbox" class="pageSel" data-id="${i}" checked> Page ${i}</label>
    </div>`;
      }
    }

    extractBtn.onclick = async () => {
      if (!pdf) { alert("Load PDF first"); return; }
      output.value = ""; logEl.textContent = "Extracting...";
      const selected = [...document.querySelectorAll(".pageSel:checked")].map(x => parseInt(x.dataset.id));
      if (!selected.length) { alert("Select at least one page"); return; }

      let finalText = "";

      for (let pi = 0; pi < selected.length; pi++) {
        const pageNum = selected[pi];
        const page = await pdf.getPage(pageNum);

        if (enableOCR.checked) {
          log("OCR page " + pageNum + "...");
          const vp = page.getViewport({ scale: 2 });
          const c = document.createElement("canvas");
          c.width = vp.width; c.height = vp.height;
          await page.render({ canvasContext: c.getContext("2d"), viewport: vp }).promise;
          const ocr = await Tesseract.recognize(c, "eng");
          finalText += `\n\n--- Page ${pageNum} ---\n` + ocr.data.text;
        } else {
          log("Extracting text from page " + pageNum);
          const content = await page.getTextContent();
          const text = content.items.map(it => it.str).join(" ");
          finalText += `\n\n--- Page ${pageNum} ---\n` + text;
        }
        setProgress((pi + 1) / selected.length);
      }

      output.value = finalText;
      log("Done.");
      setProgress(-1);
    };

    document.getElementById("copyBtn").onclick = () => {
      navigator.clipboard.writeText(output.value);
      alert("Copied!");
    };

    document.getElementById("downloadBtn").onclick = () => {
      const blob = new Blob([output.value], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "extracted.txt";
      a.click();
    };

    document.getElementById("clearBtn").onclick = () => {
      pdf = null; thumbs.innerHTML = ""; output.value = ""; logEl.textContent = "Ready.";
    };
  </script>
</body>

</html>
